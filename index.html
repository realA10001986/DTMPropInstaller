<!doctype html>
<html lang="en">
<head>
<link rel='shortcut icon' type='image/png' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA9QTFRFjpCRzMvH9tgx8iU9Q7YkHP8yywAAAC1JREFUeNpiYEQDDIwMKAAkwIwEiBTAMIMFCRApgGEGExIgUgDDDHQBNAAQYADhYgGBZLgAtAAAAABJRU5ErkJggg=='>

<script type="module" src="js/install-button.js?module"></script>

<style type='text/css'>
body{font-family:-apple-system,BlinkMacSystemFont,system-ui,'Segoe UI',Roboto,'Helvetica Neue',Verdana,Helvetica;line-height:150%}H1,H2{margin-top:0.5em;margin-bottom:1em;text-align:center;}H3{margin-top:0px;margin-bottom:5px;text-align:center;}div.msg{border:1px solid #ccc;border-left-width:15px;border-radius:20px;background:linear-gradient(320deg,rgb(255,255,255) 0%,rgb(235,234,233) 100%);}.button{cursor:pointer;font-size:1.2rem;line-height: 2.4rem;border-radius:.3rem;border:thin inset;transition-delay:250ms;margin-top:10px;margin-bottom:10px;color:#fff;background-color:#225a98;font-variant-caps:all-small-caps;transition: 0s opacity;transition-delay: 3s;transition-duration: 0s;}input[type='checkbox']{display:inline-block;margin-top:10px}input{border:thin inset}small{display:none}em > small{display:inline}form{margin-block-end:0;}.tpm{cursor:pointer;border:1px solid black;border-radius:5px;padding:0 0 0 0px;min-width:18em;}.tpm2{position:absolute;top:-0.7em;z-index:130;left:0.7em;}.tpm3{width:4em;height:4em;}.tpmh1{font-variant-caps:all-small-caps;font-weight:normal;margin-left:2em;}.tpmh3{background:#000;font-size:0.6em;color:#ffa;padding-left:7em;margin-left:0.5em;margin-right:0.5em;border-radius:5px}.sects{background-color:#eee;border-radius:7px;margin-bottom:20px;padding-bottom:7px;padding-top:7px}.tpm0{position:relative;width:20em;margin:0 auto 0 auto;}.headl{margin:0 0 5px 0;padding:0}.cmp0{margin:0;padding:0;}.sel0{font-size:90%;width:auto;margin-left:10px;vertical-align:baseline;}.mt5{margin-top:5px!important}
:root {
  --esp-tools-button-color: #225a98;
  --esp-tools-button-text-color: #fff;
  --esp-tools-button-border-radius: 3px;
}
</style>	

</head>

<body>
	
<div style="padding:20px">
	
<img src="img/ebrownenter.png" style="display:block;width:30em;margin:0px auto 0px auto;">
		
<hr style="width:60%">	

<img src="img/logo.png" style="display:block;width:40em;margin:0px auto 0px auto;">

<H1>Delorean Time Machine Prop Firmware Installer</h1>

<p>This page is intended to ease initial firmware installation on fresh ESP32 boards for use in <a href="https://circuitsetup.us" target=_blank>CircuitSetup</a>/A10001986-designed DTM props such as <a href="https://tcd.out-a-ti.me">Time Circuits Display</a>, <a href="https://fc.out-a-ti.me">Flux Capacitor</a>, <a href="https://sid.out-a-ti.me">SID</a>, <a href="https://dg.out-a-ti.me">Dash Gauges</a>, <a href="https://vsr.out-a-ti.me">VSR</a> or <a href="https://remote.out-a-ti.me">Futaba Remote Control</a> kit. The installation works without installing any software apart from a USB driver. You don't have to deal with source code, compilers, libraries and the likes.</p>

<p>Requirements:</p>
<ul>
<li>NodeMCU ESP32 board (or TCD Control Board >= 1.4)</li>
<li>USB cable</li>
<li>Computer with Windows 10 or later, or MacOS >= 10.15.7</li>
<li>Google Chrome or Microsoft Edge browser</li>
<li>Driver for the USB bridge on your ESP32 board, see below</li>
</ul>

<p>Driver for USB connection</p> 
<ul>
<li>For ESP32 boards with a <b>CP210x USB-to-UART</b> chip (CircuitSetup boards all have those):<ul><li><b>Windows</b> is said to come with a suitable driver. After connecting the ESP32, start the Device Manager, expand the "Ports (COM & LPT)" list and look for a port with the ESP32 or CP210x name. If there is none, or Windows shows messages about unsupported hardware or a missing driver, please install <a href="https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers?tab=downloads" target=_blank>this</a>. </li><li><b>MacOS</b> supports this chip since around 10.15.7 (Catalina). The port is named "cu.usbserial-XXXX" ('XXXX' being a random number). If no such port is created upon connection, install <a href="https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers?tab=downloads" target=_blank>this</a> driver. The port is named "cu.SLAB_USBtoUART" after installing this driver. <i>Do not use this driver to upload a firmware on TCD Control Boards >= 1.4, it will fail. Use the Apple built-in driver instead.</i></ul></li>
<li>For ESP32 boards with a <b>CH340 USB-to-UART</b> chip,<ul><li><b>Windows</b> users may need to install a <a href="http://www.wch-ic.com/downloads/CH341SER_ZIP.html" target=_blank>driver</a>; see above on how to find out about the port.</li><li>On <b>Mac</b>, the port is named cu.usbserial-XXXX, no additional driver is required for MacOS Mojave and later.</li></ul></li>
</ul>	

<p>Let's get started:</p>
<ol>
<li style="margin-bottom:1em">Please select which prop you want to install:
	<ul style="list-style: none;">
	<li><label><input type="radio" name="type" value="-tcd"> Time Circuits Display (A10001986 edition)</label></li>
	<li><label><input type="radio" name="type" value="-fc"> Flux Capacitor</label></li>
	<li><label><input type="radio" name="type" value="-sid"> SID</label></li>
	<li><label><input type="radio" name="type" value="-dg"> Dash Gauges</label></li>
	<li><label><input type="radio" name="type" value="-vsr"> VSR</label></li>
	<li><label><input type="radio" name="type" value="-remote"> Futaba Remote Control</label></li>
	<li><label><input type="radio" name="type" value="" checked="checked"> Generic - use this for <a href="https://github.com/CircuitSetup/Time-Circuits-Display/releases" target=_blank>CircuitSetup TCD releases</a></label></li>
	</ul>
</li>
<li>Now connect your ESP32 board to your computer through USB and wait a few seconds. At this point, Windows users need to find out about the port to choose, see above. Then click <i>Connect</i>, select a port, and click <i>Install [prop type]</i>.<br>
<div style="margin-left:auto;margin-right:auto;padding:10px;">		
<esp-web-install-button manifest="https://reala10001986.github.io/DTMPropInstaller/manifest.json">
  <button slot="activate" class="button">Connect</button>
  <span slot="unsupported"><i>Your browser is not supported. Please use Google Chrome or Microsoft Edge.</i></span>
  <span slot="not-allowed"><i>HTTPS required, HTTP not supported</i></span>	
</esp-web-install-button>

</li>
<li>After the upload has finished, disconnect the ESP32 board from your computer and put it in/on your prop (if you haven't done that already).<br><br>If you chose <i>Generic</i>, please power-up the prop and connect your computer or hand-held to the WiFi network named "NP-AP". Navigate your browser to <a href="http://install.local">http://install.local</a> or <a href="http://192.168.4.1">http://192.168.4.1</a> and click on <i>Update</i>. On the page presented then, select the firmware binary to be installed (eg. a firmware binary from a <a href="https://github.com/CircuitSetup/Time-Circuits-Display/releases" target=_blank>CircuitSetup Time Circuits release</a>), and click <i>UPDATE</i> to proceed. The selected firmware will be installed on your ESP32.</li>
</ol>
	
<p>Future firmware uploads/updates can be done through the prop's WiFi-accessible Config Portal.</p>

<script>
      document.querySelectorAll('input[name="type"]').forEach(radio =>
        radio.addEventListener("change", () => {
          const button = document.querySelector('esp-web-install-button');
          button.setAttribute("manifest", `https://reala10001986.github.io/DTMPropInstaller/m/manifest${radio.value}.json`);
        }
      ));
</script>

</div>

</body>

</html>